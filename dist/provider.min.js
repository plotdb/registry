!function(){var t=require("node-fetch"),i=require("lderror"),r=t,n=function(t){return this._name=(t=null==t?{}:t).name||"unnamed"+n._idx++,this._ps=[].concat(t.chain||[]),this._fetch=t.fetch,this._url=t.url,this._opt=t.opt||{},this};n._hash={},n._idx=0,n.add=function(t){return this._hash[t._name]=t},n.get=function(t){return this._hash[t]},n.prototype=((t=Object.create(Object.prototype)).url=function(t){return this._url(t)},t.fetch=function(e){var r,u=this;return null==e&&(e={}),(r=function(n){var t;if(0<=(n=-1===(n=null==n?-1:n)&&!u._fetch?0:n)){if(!(t=u._ps[n]))return i.reject(404);t=t._fetch(e)}else t=u._fetch(e);return t.catch(function(t){return 404!==i.id(t)?Promise.reject(t):r(n+1)}).then(function(t){return t})})()},t.chain=function(t){this._ps.splice.apply(this._ps,[0,0].concat(t))},t),n.add(new n({name:"github",url:function(t){var n=t.name,e=t.version,t=t.path;return"https://raw.githubusercontent.com/"+n.replace(/^@/,"")+"/v"+e+"/"+t},fetch:function(t){var n=this._opt.token?{Authorization:"token "+this._opt.token}:{};return r(this.url(t),{method:"GET",headers:n}).catch(function(){return i.reject(404)}).then(function(t){return 404===t.status?i.reject(404):t.text()}).then(function(t){return{version:version,content:t}})}})),n.add(new n({name:"jsdelivr",url:function(t){var n=t.name,e=t.version,t=t.path;return"https://cdn.jsdelivr.net/npm/"+n+(e&&"@"+e||"")+(t&&"/"+t||"")},fetch:function(t){return r(this.url(t)).catch(function(){return i.reject(404)}).then(function(t){var n=t.headers.get("x-jsd-version");return n?t.text().then(function(t){return{version:n||version,content:t}}):i.reject(404)})}})),n.add(new n({name:"unpkg",url:function(t){var n=t.name,e=t.version,t=t.path;return"https://unpkg.com/"+n+(e&&"@"+e||"")+(t&&"/"+t||"")},fetch:function(e){return null==e&&(e={}),r(this.url(e)).catch(function(){return i.reject(404)}).then(function(t){var n=(/^https:\/\/unpkg.com\/([^@]+)@([^/]+)\//.exec(t.url)||[])[2];return t.text().then(function(t){return{version:n||e.version,content:t}})})}})),"undefined"!=typeof module&&null!==module?module.exports=n:"undefined"!=typeof window&&null!==window&&(window.registry=n)}.call(this);
