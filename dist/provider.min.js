!function(){var o,i,n,t;t=require("node-fetch"),o=require("lderror"),i=t,(n=function(t){return this._name=(t=null==t?{}:t).name||"unnamed"+n._idx++,this._ps=[].concat(t.chain||[]),this._fetch=t.fetch,this._url=t.url,this._opt=t.opt||{},this})._hash={},n._idx=0,n.add=function(t){return this._hash[t._name]=t},n.get=function(t){return this._hash[t]},n.prototype=((t=Object.create(Object.prototype)).url=function(t){return this._url(t)},t.opt=function(t){return this._opt=t||{}},t.fetch=function(e){var r,u=this;return null==e&&(e={}),(r=function(n){var t;if(0<=(n=-1===(n=null==n?-1:n)&&!u._fetch?0:n)){if(!(t=u._ps[n]))return o.reject(404);t=t._fetch(e)}else t=u._fetch(e);return t.catch(function(t){return 404!==o.id(t)?Promise.reject(t):r(n+1)}).then(function(t){return t})})()},t.chain=function(t){this._ps.splice.apply(this._ps,[0,0].concat(t))},t),n.add(new n({name:"github",url:function(t){var n=t.name,e=t.version,t=t.path;return"https://raw.githubusercontent.com/"+n.replace(/^@/,"")+"/v"+e+"/"+t},fetch:function(e){var r=this,u={};return Promise.resolve().then(function(){var t,n=/^@([^/]+)\/(.+)$/.exec(e.name),n=n?n[1]:null;return function(t,n){var e,r={}.hasOwnProperty;for(e in n)r.call(n,e)&&(t[e]=n[e]);return t}(u,e).name=e.name.replace(/^@/,""),t=(n=r._opt?((t=r._opt).scope||(t.scope={}))[n]||((t=r._opt).repo||(t.repo={}))[e.name]||r._opt.token:null)?{Authorization:"token "+n}:{},n||"github"===e.ns?i(r.url(u),{method:"GET",headers:t}):o.reject(404)}).catch(function(t){return 404===o.id(t)?o.reject(404):Promise.reject(t)}).then(function(t){return 404===t.status?o.reject(404):t.text()}).then(function(t){return{version:e.version,content:t}})}})),n.add(new n({name:"jsdelivr",url:function(t){var n=t.name,e=t.version,t=t.path;return"https://cdn.jsdelivr.net/npm/"+n+(e&&"@"+e||"")+(t&&"/"+t||"")},fetch:function(t){return i(this.url(t)).catch(function(){return o.reject(404)}).then(function(t){var n=t.headers.get("x-jsd-version");return n?t.text().then(function(t){return{version:n||version,content:t}}):o.reject(404)})}})),n.add(new n({name:"unpkg",url:function(t){var n=t.name,e=t.version,t=t.path;return"https://unpkg.com/"+n+(e&&"@"+e||"")+(t&&"/"+t||"")},fetch:function(e){return null==e&&(e={}),i(this.url(e)).catch(function(){return o.reject(404)}).then(function(t){var n=(/^https:\/\/unpkg.com\/([^@]+)@([^/]+)\//.exec(t.url)||[])[2];return t.text().then(function(t){return{version:n||e.version,content:t}})})}})),"undefined"!=typeof module&&null!==module?module.exports=n:"undefined"!=typeof window&&null!==window&&(window.registry=n)}.call(this);
